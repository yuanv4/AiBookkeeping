{% extends "base.html" %}

{% block title %}交易记录 - 银行账单分析系统{% endblock %}

{% block header_title %}交易记录{% endblock %}

{% block page_css %}
<link href="{{ url_for('static', filename='css/transactions.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="mb-2">交易记录</h1>
        <p class="subheading">查看和搜索您的所有交易记录，共 <span class="badge bg-primary rounded-pill" id="total-count">{{ total_count }}</span> 条</p>
    </div>
</div>

<!-- 分页数据元素 -->
<div id="current-page-data" 
     data-page="{{ data.pagination.page }}" 
     data-limit="{{ data.pagination.limit }}" 
     data-pages="{{ data.pagination.pages }}"
     style="display: none;"></div>

<!-- 交易数据元素 -->
<div id="transactions-data" 
     data-transactions='{{ transactions_json|safe }}' 
     style="display: none;"></div>

<!-- 筛选表单 -->
<div class="card mb-4 filter-form-container">
    <div class="card-header">
        <div class="d-flex align-items-center">
            <i class="material-icons-round me-2 icon-primary">filter_list</i>
            <span>筛选条件</span>
        </div>
    </div>
    <div class="card-body">
        <form id="filter-form" class="row g-3 filter-form">
            <div class="col-lg-4 col-md-6">
                <label for="category" class="form-label">交易类型</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="material-icons-round icon-sm">category</i></span>
                    <select class="form-select" id="category">
                        <option value="">全部类型</option>
                        {% for cat in data.categories %}
                        <option value="{{ cat }}" {% if data.filters.type == cat %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <label for="bankAccount" class="form-label">银行/卡号</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="material-icons-round icon-sm">account_balance</i></span>
                    <select class="form-select" id="bankAccount">
                        <!-- 银行/卡号选项将通过JavaScript动态填充 -->
                    </select>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <label for="search" class="form-label">关键词搜索</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="material-icons-round icon-sm">search</i></span>
                    <input type="text" class="form-control" id="search" placeholder="输入关键词...">
                </div>
            </div>
            <div class="col-12 text-end mt-4 filter-actions">
                <button type="button" id="reset-filters" class="btn btn-outline-secondary me-2">
                    <i class="material-icons-round icon-md icon-align-middle">refresh</i>
                    重置
                </button>
                <button type="button" id="apply-filters" class="btn btn-primary">
                    <i class="material-icons-round icon-md icon-align-middle">search</i>
                    搜索
                </button>
            </div>
        </form>
    </div>
</div>

<!-- 交易记录表格 -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <i class="material-icons-round me-2 icon-primary">receipt_long</i>
            <span>交易明细</span>
        </div>
        <div>
            <button id="download-csv" class="btn btn-sm btn-outline-primary me-2 export-btn">
                <i class="material-icons-round icon-sm icon-align-middle">download</i>
                导出CSV
            </button>
            <span class="badge rounded-pill bg-primary" id="filtered-count">{{ data.transactions|length }}</span> / <span class="badge rounded-pill bg-secondary">{{ total_count }}</span>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0 transactions-table" id="transactions-table">
                <thead>
                    <tr>
                        <th>序号</th>
                        <th>日期</th>
                        <th>类型</th>
                        <th>交易对象</th>
                        <th>金额</th>
                        <th>账户余额</th>
                        <th>账号</th>
                        <th>银行</th>
                    </tr>
                </thead>
                <tbody id="transactions-body">
                    <!-- 表格内容将通过JavaScript动态填充 -->
                </tbody>
            </table>
        </div>
        
        <!-- 分页控件 -->
        <div id="pagination-container" class="pagination-container">
            <ul class="pagination justify-content-center" id="pagination">
                <!-- 分页按钮将通过JavaScript动态填充 -->
            </ul>
        </div>
        
        <!-- 无数据提示 -->
        <div id="no-data" class="no-data-container" style="display: none;">
            <i class="material-icons-round icon-xxl icon-light">search_off</i>
            <p class="mt-3 text-muted">没有找到匹配的交易记录</p>
            <button id="reset-all" class="btn btn-outline-primary mt-2">
                <i class="material-icons-round icon-sm icon-align-middle">refresh</i>
                重置筛选条件
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/transactions.js') }}"></script>
{% endblock %}

<style>
    .positive {
        color: #28a745;
        font-weight: bold;
    }
    .negative {
        color: #dc3545;
        font-weight: bold;
    }
</style>