{% extends "base.html" %}
{% from "macros.html" import icon, card, chart_container, page_header, stat_card %}

{% block title %}{{ page_title }} - {{ config.APP_NAME }}{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">
{% endblock %}

{% block content %}
<div class="page-container">
    {{ page_header("收入分析", "深入了解您的收入来源和趋势变化", "trending-up") }}
    
    <!-- 数据容器 -->
    <div id="income-data" style="display: none;"
         data-monthly-trends="{{ template_data.monthly_trends | tojson | e }}"
         data-income-sources="{{ template_data.income_sources | tojson | e }}"
         data-total-income="{{ template_data.total_income }}"
         data-avg-monthly-income="{{ template_data.avg_monthly_income }}"
         data-growth-rate="{{ template_data.growth_rate }}"
         data-transaction-count="{{ template_data.transaction_count }}">
    </div>

    <!-- 收入关键指标卡片网格 -->
    <div class="cards-grid cols-4">
        <!-- 总收入卡片 -->
        {{ stat_card("trending-up", "¥" + "%.2f"|format(template_data.total_income or 0), "总收入", "success", "success") }}
        
        <!-- 月均收入卡片 -->
        {{ stat_card("calendar", "¥" + "%.2f"|format(template_data.avg_monthly_income or 0), "月均收入", "primary", "primary") }}
        
        <!-- 收入增长率卡片 -->
        {{ stat_card("arrow-up-right", "%.1f"|format(template_data.income_growth_rate or 0) + "%", "收入增长率", "info", "info") }}
        
        <!-- 收入笔数卡片 -->
        {{ stat_card("hash", template_data.transaction_count or 0, "收入笔数", "warning", "warning") }}
    </div>
    
    <!-- 图表分析区域 -->
    <div class="col-12">
        <!-- 月度收入趋势图 -->
        {% call card("月度收入趋势", "trending-up") %}
        <canvas id="incomeMonthlyTrendChart" class="chart-canvas"></canvas>
        {% endcall %}
        
        <!-- 收入来源分析图 -->
        {% call card("收入来源分析", "pie-chart") %}
        <canvas id="incomeSourceChart" class="chart-canvas"></canvas>
        {% endcall %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/income_analysis.js') }}"></script>
{% endblock %}