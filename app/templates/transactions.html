{% extends "base.html" %}
{% from "macros.html" import page_header, data_table %}

{% block title %}交易记录 - {{ config.APP_NAME }}{% endblock %}

{% block page_css %}
<link href="{{ url_for('static', filename='css/pages/transactions.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid">
    {{ page_header("交易记录", "查看和管理您的所有交易记录", "receipt") }}

    <!-- 交易列表 -->
    <div class="row mt-4">
        <div class="col-12" id="transactions-table-container">
            {% set headers = ['日期', '账户', '对手信息', '摘要', '金额', '余额'] %}
            {% set filters = [
                {
                    'id': 'transactions-table-account-filter',
                    'label': '账户',
                    'type': 'text',
                    'placeholder': '搜索账户名或卡号'
                },
                {
                    'id': 'transactions-table-counterparty-filter',
                    'label': '对手信息',
                    'type': 'text',
                    'placeholder': '搜索对手信息'
                },
                {
                    'id': 'transactions-table-description-filter',
                    'label': '摘要',
                    'type': 'text',
                    'placeholder': '搜索交易摘要'
                },
                {
                    'id': 'transactions-table-date',
                    'label': '日期范围',
                    'type': 'daterange'
                }
            ] %}

            <!-- 使用增强版表格宏 -->
            {{ data_table(
                id="transactions-table",
                headers=headers,
                title="交易明细",
                total=total_count,
                filtered=total_count,
                sortable=true,
                filterable=true,
                filters=filters,
                icon_name="receipt"
            ) }}

            <!-- 固定汇总行 -->
            <div id="transactions-summary-footer" class="transactions-summary-footer">
                <div class="summary-content">
                    <div class="summary-item summary-expense">
                        <span class="summary-label">支出</span>
                        <div class="summary-values">
                            <span class="summary-amount" id="summary-expense-amount">¥0.00</span>
                            <span class="summary-count" id="summary-expense-count">0笔</span>
                        </div>
                    </div>
                    <div class="summary-item summary-income">
                        <span class="summary-label">收入</span>
                        <div class="summary-values">
                            <span class="summary-amount" id="summary-income-amount">¥0.00</span>
                            <span class="summary-count" id="summary-income-count">0笔</span>
                        </div>
                    </div>
                    <div class="summary-item summary-balance">
                        <span class="summary-label">最新余额</span>
                        <div class="summary-values">
                            <span class="summary-amount" id="summary-latest-balance">¥0.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 统一的数据容器，供JavaScript使用 -->
            <div id="page-data"
                 data-initial-data='{{ {
                     "transactions": transactions,
                     "total_count": total_count
                 }|tojson|safe }}'
                 style="display: none;">
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block page_scripts %}
<script src="{{ url_for('static', filename='js/components/data-table.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/transactions-table.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/pages/transactions.js') }}"></script>
{% endblock %}